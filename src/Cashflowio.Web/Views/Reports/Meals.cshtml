@using System.Globalization
@using Cashflowio.Core.Interfaces
@model IEnumerable<Expense>
@inject IRepository Repository
@{
    var exchangeRateById = Repository.List<ExchangeRate>().ToDictionary(x => x.Id, x => x.Value);
    var ci = new CultureInfo("es-MX");
}

@section styles
{
    <style>
        /* Darker Daterange Picker */
        
        .daterangepicker td.off, .daterangepicker td.off.in-range, .daterangepicker td.off.start-date, .daterangepicker td.off.end-date {
          background-color: transparent;
          color: rgba(200,200,200,0.5);
        }
        .daterangepicker {
          background-color: inherit;
          color: #ebf4f0;
        }
        
        .daterangepicker .calendar-table {
          background-color: transparent;
        }
        
        .datepicker.dropdown-menu table  {
          background-color: transparent;
        }
        .daterangepicker td.active, .daterangepicker td.active:hover {
          background-color: transparent;
          color: #ebf4f8;
        }
        .daterangepicker td.in-range {
          background-color: rgba(37,47,57,0.9);
          color: #ebf4f8;
        }
        .btn-success {
          color: #fff;
          background-color: inherit;
          border-color: rgba(5,150,1,0.8);
        }
        .btn-success.disabled, .btn-success[disabled], fieldset[disabled] .btn-success, .btn-success.disabled:hover, .btn-success[disabled]:hover, fieldset[disabled] .btn-success:hover, .btn-success.disabled:focus, .btn-success[disabled]:focus, fieldset[disabled] .btn-success:focus, .btn-success.disabled.focus, .btn-success[disabled].focus, fieldset[disabled] .btn-success.focus, .btn-success.disabled:active, .btn-success[disabled]:active, fieldset[disabled] .btn-success:active, .btn-success.disabled.active, .btn-success[disabled].active, fieldset[disabled] .btn-success.active {
          color: #fff;
          background-color: inherit;
          border-color: rgba(5,150,1,0.1);
        }
        .btn-default {
          color: #fff;
          background-color: inherit;
          border-color: rgba(255,255,255,0.6);
        }
        .daterangepicker select.monthselect {
          color: rgba(37,47,57,0.9);
        }
        .daterangepicker select.yearselect {
          color: rgba(37,47,57,0.9);
        }
        .daterangepicker .input-mini {
          color: #ebf4f8;
        }
    </style>
}

@section actionbar{
    <form>
        <input class="form-control daterange" autocomplete="off">
    </form>
}

<table class="table table-striped">
    <thead>
    <tr>
        <th></th>
        <th>Total</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var expensesByDate in Model.GroupBy(x => x.Date.DayOfWeek))
    {
        <tr>
            <th>@ci.DateTimeFormat.GetDayName(expensesByDate.Key)</th>
            <td>@expensesByDate.Sum(x => x.ExchangeRateId == null ? x.Amount : x.Amount * exchangeRateById[x.ExchangeRateId.Value]).ToString("C0")</td>
        </tr>
    }
    </tbody>
</table>

@section scripts
{
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                pageLength: 7,
            });
            
                $('.daterange').daterangepicker({
                                autoUpdateInput: false,
                                 ranges: {
                                           'Today': [moment(), moment()],
                                           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                                           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                                           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                                           'This Month': [moment().startOf('month'), moment().endOf('month')],
                                           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                                        },
                                "locale": {
                                    "format": "DD/MM/YYYY",
                                    "separator": " - ",
                                    "applyLabel": "Aplicar",
                                    "cancelLabel": "Limpiar",
                                    "fromLabel": "De",
                                    "toLabel": "Hasta",
                                    "customRangeLabel": "Personalizado",
                                    "weekLabel": "W",
                                    "daysOfWeek": [
                                        "Do",
                                        "Lu",
                                        "Ma",
                                        "Mi",
                                        "Ju",
                                        "Vi",
                                        "Sa"
                                    ],
                                    "monthNames": [
                                        "Enero",
                                        "Febrero",
                                        "Marzo",
                                        "Abril",
                                        "Mayo",
                                        "Junio",
                                        "Julio",
                                        "Agosto",
                                        "Septiembre",
                                        "Octubre",
                                        "Noviembre",
                                        "Diciembre"
                                    ],
                                    "firstDay": 1
                                }
                            });
            
                            $('.daterange').on('apply.daterangepicker',
                                function(ev, picker) {
                                    $(this).val(picker.startDate.format('DD/MM/YYYY') +
                                            ' - ' +
                                            picker.endDate.format('DD/MM/YYYY'))
                                        .change();
                                });
            
                            $('.daterange').on('cancel.daterangepicker',
                                function() {
                                    $(this).val('').change();
                                });

        });
    </script>
}